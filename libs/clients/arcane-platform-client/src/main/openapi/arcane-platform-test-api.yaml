swagger: "2.0"

info:
  title: Arcane Platform Acceptance Test API
  description: "Arcane Platform Acceptance Test API"
  version: "1.0.0"

host: test.api.arcane.no

schemes:
  - "https"

paths:

  "/ping":
    get:
      description: "Ping endpoint for checking uptime and connectivity"
      operationId: "ping"
      responses:
        200:
          description: "pong"
          schema:
            type: string
  "/utc":
    get:
      description: "utc endpoint for checking server time"
      operationId: "utc"
      responses:
        200:
          description: "UTC timestamp"
          schema:
            type: string
      security:
        - firebase: [ ]


  "/whoami":
    get:
      description: "Get OAuth2 JWT payload"
      operationId: "whoami"
      responses:
        200:
          description: "Get OAuth2 JWT payload json"
          schema:
            type: string
      security:
        - firebase: [ ]
  "/firebase-custom-token":
    get:
      description: |
        Pass Apple id_token as Bearer value to Auth header.
        If the token is valid, it will try to find an existing user using email from id_token.
        If the user does not exist, it will create a new user.
        For valid Apple id_token, it returns Firebase custom token for new/existing user.
      operationId: "getFirebaseCustomToken"
      responses:
        200:
          description: "Firebase custom token"
          schema:
            type: string
      security:
        - apple: [ ]


  "/user":
    get:
      description: "Get user"
      operationId: getUser
      responses:
        200:
          description: User
          schema:
            $ref: "#/definitions/User"
      security:
        - firebase: [ ]
    post:
      description: |
        Create user using userId from JWT OAuth Identity token in Authentication Bearer header.
        New Analytics ID will be assigned to this user.
      operationId: createUser
      responses:
        200:
          description: "Created User"
          schema:
            $ref: "#/definitions/User"
      security:
        - firebase: [ ]


  "/tnc/{tnc-id}":
    get:
      description: "Get Terms & Conditions response"
      operationId: "getTnc"
      parameters:
        - name: tnc-id
          in: path
          type: string
          required: true
      responses:
        200:
          description: "Terms & Conditions"
          schema:
            $ref: "#/definitions/TncResponse"
        404:
          description: "Terms & Conditions were not submitted"
      security:
        - firebase: [ ]
    post:
      description: "Save Terms & Conditions response"
      operationId: "setTnc"
      parameters:
        - name: tnc-id
          in: path
          type: string
          required: true
        - name: tnc
          in: body
          schema:
            $ref: "#/definitions/TncRequest"
      responses:
        200:
          description: "Saved Terms & Conditions"
          schema:
            $ref: "#/definitions/TncResponse"
      security:
        - firebase: [ ]
  "/tnc/{tnc-id}/email":
    post:
      description: "Send Terms & Conditions in email"
      operationId: "sendTncEmail"
      parameters:
        - name: tnc-id
          in: path
          type: string
          required: true
      responses:
        200:
          description: "Terms & Conditions sent in email"
      security:
        - firebase: [ ]


definitions:

  User:
    type: object
    properties:
      userId:
        type: string
      analyticsId:
        type: string
    required:
      - userId
      - analyticsId


  TncRequest:
    type: object
    properties:
      version:
        type: string
      accepted:
        type: boolean
      spaceId:
        type: string
      entryId:
        type: string
      fieldId:
        type: string
    required:
      - version
      - accepted
      - spaceId
      - entryId
      - fieldId
  TncResponse:
    type: object
    properties:
      tncId:
        type: string
      version:
        type: string
      accepted:
        type: boolean
      spaceId:
        type: string
      entryId:
        type: string
      fieldId:
        type: string
      timestamp:
        type: string
        format: date-time
    required:
      - tncId
      - version
      - accepted
      - spaceId
      - entryId
      - fieldId
      - timestamp


securityDefinitions:
  firebase:
    authorizationUrl: ""
    flow: "implicit"
    type: "oauth2"
    x-google-issuer: "oauth2-provider-emulator"
    x-google-jwks_uri: "http://oauth2-provider-emulator:8080/auth/keys"
    x-google-audiences: "acceptance-tests"
  apple:
    authorizationUrl: ""
    flow: "implicit"
    type: "oauth2"
    x-google-issuer: "https://appleid.apple.com"
    x-google-jwks_uri: "https://appleid.apple.com/auth/keys"
    x-google-audiences: "no.arcane.platform.client.web"